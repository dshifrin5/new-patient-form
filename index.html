<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>New Patient Packet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-image: url('https://raw.github.com/dshifrin5/new-patient-form/main/66D89306-626F-4A08-82D4-0AF26460A22D.png');
      background-size: cover;
      background-repeat: repeat-y;
      background-attachment: fixed;
      background-position: center top;
      background-color: #d6f4ff;
    }

    .container {
      background-color: rgba(234, 248, 255, 0.95);
      border-radius: 10px;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }

    canvas {
      border: 1px solid #ccc;
      width: 100%;
      height: 200px;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    .invalid {
      border: 2px solid red !important;
    }

    .required-star {
      color: red;
      margin-left: 4px;
    }

    label span.optional {
      font-weight: normal;
      font-style: italic;
      font-size: 0.9em;
      color: gray;
      margin-left: 5px;
    }
    .accordion-button:focus {
      box-shadow: none;
      outline: none;
    }
  </style>

</head>
<body class="bg-light">
<div class="container py-4">
  <div class="text-center mb-3">
    <img src="https://raw.githubusercontent.com/dshifrin5/new-patient-form/main/Bite-Squad-Small-ezgif.com-webp-to-png-converter.png" alt="Pediatric Dentistry NYC Logo" style="max-width: 250px; height: auto;" />
  </div>
  <h2 class="text-center mb-4">New Patient Packet</h2>
  <form id="multiStepForm">
    <!-- Step 1 -->
    <div class="step active" id="step1">
      <h4>Patient Information</h4>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">First Name <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="first_name" />
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Last Name <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="last_name" />
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Middle Initial</label>
          <input type="text" class="form-control" name="middle_initial" maxlength="1" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Gender <span class="required-star">*</span></label>
          <select class="form-select required" name="gender">
            <option value="">Select...</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Family Status <span class="required-star">*</span></label>
          <select class="form-select required" name="family_status">
            <option value="">Select...</option>
            <option>Married</option>
            <option>Single</option>
            <option>Child</option>
            <option>Other</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Birth Date <span class="required-star">*</span></label>
          <input type="date" class="form-control required" name="birth_date" />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Email Address <span class="required-star">*</span></label>
          <input type="email" class="form-control required" name="email" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Mobile Phone <span class="required-star">*</span></label>
          <input type="tel" class="form-control required" name="mobile" />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Home Phone <span class="optional">(optional)</span></label>
          <input type="tel" class="form-control" name="home_phone" />
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Best Time to Call <span class="required-star">*</span></label>
        <select class="form-select required" name="call_time">
          <option value="">Select...</option>
          <option>Morning</option>
          <option>Afternoon</option>
          <option>Evening</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Address 1 (Street Address) <span class="required-star">*</span></label>
        <input type="text" class="form-control required" name="address1" />
      </div>
      <div class="mb-3">
        <label class="form-label">Address 2 <span class="optional">(optional)</span></label>
        <input type="text" class="form-control" name="address2" />
      </div>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">City <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="city" />
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">State <span class="required-star">*</span></label>
          <select class="form-select required" name="state">
            <option value="">Select a state...</option>
            <option value="NY">New York</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="DC">District of Columbia</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>

        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Zip Code <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="zip" />
        </div>
      </div>
      <button type="button" class="btn btn-primary" onclick="validateStepAndNext()">Next</button>
    </div>

    <!-- Step 2 (Rewritten as requested) -->
    <div class="step" id="step2">
      <h4>Primary Dental Insurance</h4>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Insured First Name <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="insured_first" />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Insured Last Name <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="insured_last" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Insured Birth Date <span class="required-star">*</span></label>
          <input type="date" class="form-control required" name="insured_birth" />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Insured Employer's Name <span class="required-star">*</span></label>
          <input type="text" class="form-control required" name="insured_employer" />
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Insurance Plan Name <span class="required-star">*</span></label>
        <input type="text" class="form-control required" name="plan_name" />
      </div>
      <div class="mb-3">
        <label class="form-label">Patient's Relationship to Insured <span class="required-star">*</span></label>
        <div class="form-check">
          <input class="form-check-input required" type="radio" name="relationship" id="relSelf" value="self" />
          <label class="form-check-label" for="relSelf">Self</label>
        </div>
        <div class="form-check">
          <input class="form-check-input required" type="radio" name="relationship" id="relSpouse" value="spouse" />
          <label class="form-check-label" for="relSpouse">Spouse</label>
        </div>
        <div class="form-check">
          <input class="form-check-input required" type="radio" name="relationship" id="relChild" value="child" />
          <label class="form-check-label" for="relChild">Child</label>
        </div>
        <div class="form-check">
          <input class="form-check-input required" type="radio" name="relationship" id="relOther" value="other" />
          <label class="form-check-label" for="relOther">Other</label>
        </div>

      </div>
      <div class="mb-3">
        <label class="form-label">Insurance ID Number <span class="required-star">*</span></label>
        <input type="text" class="form-control required" name="insurance_id" />
      </div>
      <!-- ID Upload -->
      <div class="mb-3">
        <label class="form-label">Upload Government-Issued ID <span class="required-star">*</span></label>
        <input type="file" class="form-control required" name="id_upload" id="id-upload" accept="image/*" onchange="handleUpload(this, 'id-preview')" />
        <canvas id="id-preview" style="display:none; max-width:100%; height:auto;"></canvas>
      </div>

      <div class="mb-3">
        <label class="form-label">Upload Insurance Card Picture <span class="required-star">*</span></label>
        <input type="file" class="form-control required" name="insurance_card" id="insurance-upload" accept="image/*" onchange="handleUpload(this, 'insurance-preview')" />
        <canvas id="insurance-preview" style="display:none; max-width:100%; height:auto;"></canvas>

      </div>
      <div class="form-check mb-3">
        <input class="form-check-input required" type="checkbox" name="insurance_consent" id="insurance_consent" />
        <label class="form-check-label" for="insurance_consent">
          By checking this box, I authorize my insurance company to pay the dentist all insurance benefits rendered. I authorize the use of this electronic signature on all insurance submissions. I authorize the dentist to release all information necessary to secure the payment of benefits. I understand that I am financially responsible for all charges whether or not paid by insurance.
        </label>
      </div>
      <div class="mb-3">
        <label class="form-label">Do you have Secondary Dental Insurance? <span class="required-star">*</span></label>
        <select class="form-select required" name="has_secondary" onchange="document.getElementById('secondaryUpload').style.display = this.value === 'Yes' ? 'block' : 'none'">
          <option value="">Select...</option>
          <option>Yes</option>
          <option>No</option>
        </select>
      </div>
      <div class="mb-3" id="secondaryUpload" style="display:none">
        <label class="form-label">Upload Secondary Insurance Card <span class="optional">(optional)</span></label>
        <input type="file" class="form-control" name="secondary_card" accept="image/*" />
      </div>
      <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button type="button" class="btn btn-primary" onclick="validateStepAndNext()">Next</button>
      </div>
    </div>

    <div class="step" id="step3">
      <h4>Responsible Party Information</h4>
      <div class="mb-3">
        <label class="form-label">Who is the patient?</label>
        <select class="form-select required" name="responsible_choice" id="responsibleChoice" onchange="toggleParentFields()">
          <option value="">Select...</option>
          <option value="self">Myself</option>
          <option value="child">My Child</option>
        </select>
      </div>
      <div id="parentFields" style="display: none;">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Parent First Name <span class="required-star">*</span></label>
            <input type="text" class="form-control required-parent" name="parent_first_name">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Parent Last Name <span class="required-star">*</span></label>
            <input type="text" class="form-control required-parent" name="parent_last_name">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Gender <span class="required-star">*</span></label>
            <select class="form-select required-parent" name="parent_gender">
              <option value="">Select...</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Family Status <span class="required-star">*</span></label>
            <select class="form-select required-parent" name="parent_family_status">
              <option value="">Select...</option>
              <option>Married</option>
              <option>Single</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Birth Date <span class="required-star">*</span></label>
            <input type="date" class="form-control required-parent" name="parent_birth_date">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Email Address <span class="required-star">*</span></label>
            <input type="email" class="form-control required-parent" name="parent_email">
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
      <button type="button" class="btn btn-primary" onclick="validateStepAndNext()">Next</button>
    </div>

  <!-- Step 4 -->
  <div class="step" id="step4">
    <h4>Medical History</h4>

    <div class="mb-3">
      <label class="form-label">Physician's Name <span class="required-star">*</span></label>
      <input type="text" class="form-control required" name="physician_name">
    </div>

    <div class="mb-3">
      <label class="form-label">Preferred Pharmacy Name and Phone/Location <span class="required-star">*</span></label>
      <input type="text" class="form-control required" name="pharmacy_info">
    </div>

    <div class="mb-3">
      <label class="form-label">Have you had any serious illness or operations? <span class="required-star">*</span></label>
      <select class="form-select required" name="serious_illness" onchange="document.getElementById('illness_desc').style.display = this.value === 'Yes' ? 'block' : 'none'">
        <option value="">Select...</option>
        <option>Yes</option>
        <option>No</option>
      </select>
    </div>

    <div class="mb-3" id="illness_desc" style="display:none">
      <label class="form-label">If yes, describe:</label>
      <textarea class="form-control" name="illness_description"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Have you ever had a blood transfusion? <span class="required-star">*</span></label>
      <select class="form-select required" name="blood_transfusion" onchange="document.getElementById('transfusion_date').style.display = this.value === 'Yes' ? 'block' : 'none'">
        <option value="">Select...</option>
        <option>Yes</option>
        <option>No</option>
      </select>
    </div>

    <div class="mb-3" id="transfusion_date" style="display:none">
      <label class="form-label">If yes, approximate date:</label>
      <input type="text" class="form-control" name="transfusion_date">
    </div>

    <div class="mb-3">
      <label class="form-label">Females Only:</label>
      <div class="form-check"><input class="form-check-input" type="checkbox" name="pregnant" value="Yes"> <label class="form-check-label">Pregnant</label></div>
      <div class="form-check"><input class="form-check-input" type="checkbox" name="nursing" value="Yes"> <label class="form-check-label">Nursing</label></div>
      <div class="form-check"><input class="form-check-input" type="checkbox" name="birth_control" value="Yes"> <label class="form-check-label">Taking birth control pills</label></div>
    </div>

    <div class="mb-3">
      <label class="form-label">Check if you have or have had any of the following:</label>
      <div class="row">
        <div class="col-md-6">
          <div class="form-check"><input class="form-check-input" type="checkbox" name="anemia" value="Yes"> <label class="form-check-label">Anemia</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="arthritis" value="Yes"> <label class="form-check-label">Arthritis</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="artificial_joints" value="Yes"> <label class="form-check-label">Artificial Joints</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="asthma" value="Yes"> <label class="form-check-label">Asthma</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="blood_disease" value="Yes"> <label class="form-check-label">Blood Disease</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="cancer" value="Yes"> <label class="form-check-label">Cancer</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="cerebral_palsy" value="Yes"> <label class="form-check-label">Cerebral Palsy</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="diflucan" value="Yes"> <label class="form-check-label">DIFLUCAN</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="development_delay" value="Yes"> <label class="form-check-label">Development delay</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="diabetes" value="Yes"> <label class="form-check-label">Diabetes</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="ehlers_danlos_syndrome" value="Yes"> <label class="form-check-label">Ehlers-Danlos Syndrome</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="epilepsy" value="Yes"> <label class="form-check-label">Epilepsy</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="fainting" value="Yes"> <label class="form-check-label">Fainting</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="genetic_syndrome" value="Yes"> <label class="form-check-label">Genetic Syndrome</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="glaucoma" value="Yes"> <label class="form-check-label">Glaucoma</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="hivaids" value="Yes"> <label class="form-check-label">HIV/AIDS</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="hashimoto_disease" value="Yes"> <label class="form-check-label">Hashimoto Disease</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="head_injuries" value="Yes"> <label class="form-check-label">Head Injuries</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="heart_conditions" value="Yes"> <label class="form-check-label">Heart Conditions</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="heart_disease" value="Yes"> <label class="form-check-label">Heart Disease</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="heart_murmur" value="Yes"> <label class="form-check-label">Heart Murmur</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="hemophilia" value="Yes"> <label class="form-check-label">Hemophilia</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="hepatitis" value="Yes"> <label class="form-check-label">Hepatitis</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="high_blood_pressure" value="Yes"> <label class="form-check-label">High Blood Pressure</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="jaundice" value="Yes"> <label class="form-check-label">Jaundice</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="joint_conditions" value="Yes"> <label class="form-check-label">Joint Conditions</label></div>
        </div>
        <div class="col-md-6">
          <div class="form-check"><input class="form-check-input" type="checkbox" name="kidney_disease" value="Yes"> <label class="form-check-label">Kidney Disease</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="latent_tb" value="Yes"> <label class="form-check-label">Latent TB</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="liver_disease" value="Yes"> <label class="form-check-label">Liver Disease</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="muscular_dystrophy" value="Yes"> <label class="form-check-label">Muscular Dystrophy</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="nervous_disorders" value="Yes"> <label class="form-check-label">Nervous Disorders</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="neutropenia" value="Yes"> <label class="form-check-label">Neutropenia</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="pacemaker" value="Yes"> <label class="form-check-label">Pacemaker</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="radiation_treatment" value="Yes"> <label class="form-check-label">Radiation Treatment</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="respiratory_problems" value="Yes"> <label class="form-check-label">Respiratory Problems</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="rheumatic_fever" value="Yes"> <label class="form-check-label">Rheumatic Fever</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="rheumatism" value="Yes"> <label class="form-check-label">Rheumatism</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="scarlet_fever" value="Yes"> <label class="form-check-label">Scarlet Fever</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="seizure" value="Yes"> <label class="form-check-label">Seizure</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="shortness_of_breath" value="Yes"> <label class="form-check-label">Shortness of Breath</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="sinus_problems" value="Yes"> <label class="form-check-label">Sinus Problems</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="situs_inversus" value="Yes"> <label class="form-check-label">Situs inversus</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="spina_bifida" value="Yes"> <label class="form-check-label">Spina Bifida</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="stomach_problems" value="Yes"> <label class="form-check-label">stomach problems</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="stroke" value="Yes"> <label class="form-check-label">Stroke</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="thyroid_problems" value="Yes"> <label class="form-check-label">Thyroid Problems</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="tuberculosis" value="Yes"> <label class="form-check-label">Tuberculosis</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="tumors" value="Yes"> <label class="form-check-label">Tumors</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="ulcers" value="Yes"> <label class="form-check-label">Ulcers</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="venereal_disease" value="Yes"> <label class="form-check-label">Venereal Disease</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" name="williams_syndrome" value="Yes"> <label class="form-check-label">Williams Syndrome</label></div>
        </div>
      </div>
    </div>


    <div class="mb-3">
      <label class="form-label">Are you taking any medication? <span class="required-star">*</span></label>
      <select class="form-select required" name="taking_medication" onchange="document.getElementById('med_list').style.display = this.value === 'Yes' ? 'block' : 'none'">
        <option value="">Select...</option>
        <option>Yes</option>
        <option>No</option>
      </select>
    </div>

    <div class="mb-3" id="med_list" style="display:none">
      <label class="form-label">If yes, please list:</label>
      <textarea class="form-control" name="medications"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Do you have allergies to any medication? <span class="required-star">*</span></label>
      <select class="form-select required" name="allergies" onchange="document.getElementById('allergy_list').style.display = this.value === 'Yes' ? 'block' : 'none'">
        <option value="">Select...</option>
        <option>Yes</option>
        <option>No</option>
      </select>
    </div>

    <div class="mb-3" id="allergy_list" style="display:none">
      <label class="form-label">If yes, please list:</label>
      <textarea class="form-control" name="allergy_details"></textarea>
    </div>

    <div class="form-check mb-3">
      <input class="form-check-input required" type="checkbox" name="final_acknowledgement" id="final_acknowledgement" />
      <label class="form-check-label" for="final_acknowledgement">
        By checking this box, I acknowledge that I have reviewed ALL questions/alerts on this questionnaire and responded accordingly. There are no other medical conditions or medications/allergies that have not been listed. I am aware that I must notify the practice of any future changes. This will serve as my electronic signature.
      </label>
    </div>

    <div class="d-flex justify-content-between">
      <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
      <button type="button" class="btn btn-primary" onclick="validateStepAndNext()">Next</button>
    </div>
  </div>

  <div class="step" id="step-5">
    <h2>Step 5: Consent for Services and Financial Policy</h2>

    <div class="accordion" id="accordionStep5">

      <!-- 1. Consent for Services -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
            <b>Consent for Services</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentService" name="consentService">
            <label class="form-check-label" for="consentService">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseOne" class="accordion-collapse collapse"
             aria-labelledby="headingOne" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              I consent to the use or disclosure of my "protected health information" as defined in the Health Insurance Portability and Accountability Act of 1996 (HIPAA) and this Consent by Pediatric Dentistry NYC for the purpose of diagnosing or providing treatment to me, obtaining payment for my health care bills, or to conduct the health care operations of Pediatric Dentistry NYC. I understand that diagnosis or treatment of me by Pediatric Dentistry NYC may be conditioned upon my consent as evidenced by my signature on this document.
            </p>
            <p>
              My "protected health information" means health information, including but not limited to my demographic information, collected from me and created or received by my physician, another health care provider, a health plan, my employer or a health care clearinghouse. This protected health information relates to my past, present or future physical or mental health or condition and identifies me, or there is a reasonable basis to believe such information may identify me.
            </p>
            <p>
              I understand I have the right to request a restriction as to how my protected health information is used or disclosed to carry out treatment, payment or the healthcare operations of Pediatric Dentistry NYC. Pediatric Dentistry NYC is not required to agree to any restriction that I may request. If, however, Pediatric Dentistry NYC agrees to any restriction requested by me, such restriction shall be binding on Pediatric Dentistry NYC. I further understand that I have the right to revoke this consent, in writing, at any time, except to the extent that Pediatric Dentistry NYC has taken action in reliance on this Consent.
            </p>
            <p>
              I understand I have a right to review Pediatric Dentistry NYC's Notice of Privacy Practices prior to signing this Consent. Pediatric Dentistry NYC's Notice of Privacy Practices has been provided to me and describes the types of uses and disclosures of my protected health information that may occur in my treatment, payment of my bills or in the performance of the health care operations of Pediatric Dentistry NYC.
            </p>
            <p>
              This Notice of Privacy Practices also describes my rights and Pediatric Dentistry NYC's duties with respect to my protected health information. Please also note that as provided in Pediatric Dentistry NYC's Notice of Privacy Practices, Pediatric Dentistry NYC reserves the right to change the privacy practices that are described in such notice. I may obtain a revised Notice of Privacy Practices by accessing the Pediatric Dentistry NYC's website, calling the office at 718-998-2424 and requesting a revised copy be sent in the mail, or asking for one at the time of my next appointment.
            </p>
          </div>
        </div>
      </div>

      <!-- 2. Cancellation and Broken Appointment Policy -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            <b>Cancellation and Broken Appointment Policy</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentCancel" name="consentCancel">
            <label class="form-check-label" for="consentCancel">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.

            </label>
          </div>
        </div>
        <div id="collapseTwo" class="accordion-collapse collapse"
             aria-labelledby="headingTwo" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              Our number one concern is our patient's dental health. Providing services in a timely manner is critical to accomplish that goal. We understand that illness, emergencies, flat tires, and bad weather do occur. We ask our patients to give us 48 hours' notice whenever possible, if they cannot keep an appointment. This allows us time to fill our schedule with other patients who may be waiting.
            </p>
            <p>
              Every effort is made to contact patients the day before their appointment to confirm. Please understand that this is a courtesy call. DO NOT DEPEND ON THIS.
            </p>
            <p>
              Policy and Fees:<br>
              Cancellation or rescheduling of an appointment less than 24 hours to be considered as a broken appointment and will carry a charge of<br>
              $50.
            </p>
            <p>
              Pediatric Dentistry of NYC requires a $50 Deposit for all appointments requiring 45 minutes or more.
            </p>
            <p>
              Pediatric Dentistry of NYC requires a $50 deposit for all existing patients with two or more broken appointments in order to schedule any further appointments. 
            </p>
            <p>
              Pediatric Dentistry of NYC requires a $50 deposit for all new patients to schedule any appointment.
            </p>
            <p>
              Pediatric Dentistry of NYC requires a $100 deposit before scheduling hospital appointments.
            </p>
            <p>
               Definition of "Broken Appointment": A broken appointment is when you<br>
               - Cancel or reschedule an appointment with less than 24 hour notice<br>
               - Do not show up for the scheduled appointment 
            </p>
            <p>
              We appreciate your understanding and consideration regarding our appointment policy and if you have any questions or concerns, never hesitate to ask us. 
            </p>
          </div>
        </div>
      </div>

      <!-- 3. HIPAA Acknowledgement -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingThree">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            <b>HIPAA Acknowledgement</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentHIPAA" name="consentHIPAA">
            <label class="form-check-label" for="consentHIPAA">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseThree" class="accordion-collapse collapse"
             aria-labelledby="headingThree" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              THIS NOTICE DESCRIBES HOW MEDICAL INFORMATION ABOUT YOU MAY BE USED AND DISCLOSED AND HOW YOU CAN GET ACCESS TO THIS INFORMATION. PLEASE REVIEW IT CAREFULLY. 
            </p>
            <p>
              As part of the federal Health Insurance Portability and Accountability Act of 1996, known as HIPAA, Advanced Pediatric Dentistry ("APD") has created this Notice of Privacy Practices ("Notice"). This Notice states APD's privacy practices and the rights you, the individual, have as they relate to the privacy of your Protected Health Information ("PHI"). Your PHI is information about you, or that could be used to identify you, as it relates to your past and present physical and mental health care services. We at APD want you to know that nothing is more central to our operations than maintaining the privacy of your P1 IL We take our responsibility to protect this information very seriously. The HIPAA regulations require that APD, and our Business Associates and their subcontractors, protect the privacy of your PHI that we have received or created. For any uses or disclosures that are not listed below (Including Marketing and Selling of PHI), APD will obtain a written authorization from you for that use or disclosure, which you will have the right to revoke at any time, as explained in more detail below. APD reserves the right to change our privacy practices and this Notice. If you have questions about this Notice, please contact the Privacy Officer referenced in the Contact Information at the end of the Notice. 
            </p>
            <p>
              APD will use and disclose your PHI for many different reasons. Some of the uses or disclosures will require your prior written authorization, others will not. 
            </p>
            <p>
              Below you will find the different categories of uses and disclosures. 
            </p>
            <p>
              A. USES AND DISCLOSURES RELATED TO TREATMENT, PAYMENT, OR HEALTHCARE OPERATIONS 
            </p>
            <p>
              A healthcare provider may use and disclose your PHI without your consent for the following reasons: 
            </p>
            <p>
              a. For treatment. A healthcare provider may disclose your PHI to physicians, psychiatrists, psychologists, and other licensed health care providers who provide you with health care services or are otherwise involved in your care.<br>
              b. For health care operations. A healthcare provider may disclose your PHI to facilitate the efficient and correct operation of their practice. A healthcare provider may also provide your PHI to their attorneys, accountants, consultants, and others to make sure that they are in compliance with applicable laws.<br>
              c. To obtain payment for treatment. A healthcare provider may use and disclose your PHI to bill and collect payment for the treatment and services provided to you.<br>
              d. During an emergency. Your consent isn't required if you need emergency treatment provided that a healthcare provider attempts to get your consent after treatment is rendered. In the event that a healthcare provider tries to get your consent but you are unable to communicate with them, e.g., you are unconscious or in severe pain, but they think that you would consent to such treatment if you could, they may disclose your PHI 
            </p>
            <p>
              B. CERTAIN OTHER USES AND DISCLOSURES THAT DO NOT REQUIRE YOUR CONSENT APD may also use and disclose your PHI without your consent for the following reasons: 
            </p>
            <p>
              a. Uses and disclosures as required by law: We must disclose your PHI when required to do so by applicable federal or state law.<br>
              b. Uses and disclosure for Public Health Activities: We may disclose your PHI to federal, state, or local authorities, or other entities charged with preventing or controlling disease, injury, or disability for public health activities. These activities may include the following: disclosures to report reactions to medications or other products to the U.S. Food and Drug Administration or other authorized entity; disclosures to notify individuals of recalls, exposure to a disease, or risk for contracting or spreading a disease or condition.<br>
              c. Uses and disclosure about victims of abuse, neglect or domestic violence: APD may use or disclose PHI about you to a government authority if it is reasonably believed you are a victim of abuse, neglect or domestic violence.<br>
              d. Uses and disclosures for health oversight activities: We may disclose your PHI to an oversight agency for activities authorized by law. These oversight activities include audits, investigations, and inspections, as necessary for our licensure and for government monitoring of the health care system, government programs, and compliance with federal and applicable state law.<br>
              e. Disclosures to Individuals Involved in your Care: APD may disclose PHI about you to individuals involved in your care.<br>
              f. Disclosures for judicial and administrative proceedings: APD may disclose PHI about you in the course of any judicial or administrative proceedings, provided that proper documentation is presented to APD.<br>
              g. Disclosures for law enforcement purposes: APD may disclose PHI about you to law enforcement officials for authorized purposes as required by law or in response to a court order or subpoena.<br>
              h. Uses and disclosures about the deceased: APD may disclose PHI about a deceased, or prior to, and in reasonable anticipation of an individual's death, to coroners, medical examiners, and funeral directors.<br>
              i. Uses and disclosures for research purposes: APD may use and disclose PHI about you for research purposes with a valid waiver of authorization approved by an institutional review board or a privacy board. Otherwise, APD will request a signed authorization by the individual for all other research purposes.<br>
              j. Uses and disclosures to avert a serious threat to health or safety: APD may use or disclose PHI about you, if it believed in good faith, and is consistent with any applicable law and standards of ethical conduct, to avert a serious threat to health or safety.<br>
              k. Uses and disclosures for specialized government functions: APD may use or disclose PHI about you for specialized government functions including; military and veteran's activities, national security and intelligence, protective services, department of state functions, and correctional institutions and law enforcement custodial situations.<br>
              l. Disclosure for workers' compensation: APD may disclose PHI about you as authorized by and to the extent necessary to comply with workers' compensation laws or programs established by law.<br>
              m. Disclosures for disaster relief purposes: APD may disclose PHI about you as authorized by law to a public or private entity to assist in disaster relief efforts and for family and personal representative notification.<br>
              n. Disclosures to business associates: APD may disclose PHI about you to APD's business associates for services that they may provide to or for APD. To ensure the privacy of your PHI, we require all business associates to apply appropriate safeguards to any PHI they receive or create.<br>
              o. Disclosures after death: APD may disclose deceased individuals' PHI to non-family members, as well as family members, who were involved in the care or payment for healthcare of the decedent prior to death; however, the disclosure must be limited to PHI relevant to such care or payment and cannot be inconsistent with any prior expressed preference of the deceased individual.<br>
              p. Appointment reminders and health related benefits or services: APD is permitted to contact you, without your prior authorization, to provide appointment reminders or information about alternative or other health-related benefits and services that may be of interest to you.
            </p>
            <p>
              C. FOR ALL OTHER USES AND DISCLOSURES 
            </p>
            <p>
              In any other situation not described in Sections A and B, APD will request your written authorization before using or disclosing any of your PHI. In addition, you may revoke such an authorization in writing at any time. To revoke a previously authorized use or disclosure, please contact the Privacy Officer referenced in the Contact Information at the end of the Notice. 
            </p>
            <p>
              <b>YOUR RIGHTS</b>
            </p>
            <p>
              When it comes to your health information, you have certain rights. This section explains your rights and some of our responsibilities to help you. 
            </p>
            <p>
              A.The right to view and obtain copies of your PHI. You have a right to see, and to keep a copy of, all of your health records except psychotherapy notes and information compiled in reasonable anticipation of, or for use in, a civil, criminal, or administrative action or proceeding. Your request for a copy of your record must be in writing. We will provide a copy or a summary of your health and claims records, usually within 30 days of your request. We may charge a reasonable, cost-based fee. In very limited circumstances your request to inspect and obtain a copy of your health information may be denied. In that case, you may request that the denial be reviewed by an independent person.<br>
              B. The right to request limits on uses and disclosures of your PHI. You can ask us not to use or share certain health information for treatment, payment, or our operations. You may also request that any part of your protected health information not be disclosed to family members or friends who may be involved in your care or for notification purposes as described in this Notice. Additionally, you may obtain restrictions on the disclosure of your PHI to a health plan for payment or healthcare operations with respect to specific items and services for which you have paid out of pocket in full. To request a restriction, you must make your request in writing using the Contact Information at the end of this Notice. In your request, you must indicate (1) what information you want to limit; (2) whether you want to limit the Plan's use, disclosure or both; and (3) to whom you want the limits to apply (for example, disclosures to your spouse or parent). We are not required to agree to your request, and we may say "no" if it would affect your care.<br>
              C. The right to choose how a healthcare provider sends your PHI to you. It is your right to ask that your PHI be sent to you at an alternate address or by an alternate method. The healthcare provider is obliged to agree to your request providing that they can give you the PHI in the format you requested, without undue inconvenience.<br>
              D. You have the right to receive an accounting of disclosures - You have the right to request a list of disclosures of your health information that we have made that were not for treatment, payment, or health care operations, required by law, or authorized by you. Your written request must state the time period for the requested information and be no greater than six years prior to date of request. The healthcare provider will respond to your request for an accounting of disclosures within 60 days of receiving your request.<br>
              E. The right to amend Your PHI. If you believe that there is some error in your PHI or that important information has been omitted, it is your right to request that the healthcare provider corrects the existing information or adds the missing information. Your request and the reason for the request must be made in writing. You will receive a response within 60 days of receipt of your request. If your request is denied, you have the right to file a written statement objecting to the denial. If you do not file a written objection, you still have the right to ask that your request and the denial be attached to any future disclosures of your PHI.<br>
              F. The right to receive additional copies of this HIPAA Privacy Notice: You have the right to request an additional paper or electronic copy of this notice. You also have the right to direct the healthcare provider to transmit an electronic copy of PHI to an entity or person designated by you.<br>
              G. Notification of Breaches: You will be notified of any breaches that have compromised the privacy of your PHI.
            </p>
            <p>
              <b>ADDITIONAL HIPAA RULES AND INFORMATION</b>
            </p>
            <p>
              A. Minimum Necessary Rule: Our staff will not use or access your PHI unless it is necessary to do their jobs (i.e. doctors uninvolved in your care will not access your PHI; ancillary clinical staff caring for you will not access your billing information; billing staff will not access your PHI except as needed to complete the claim form for the latest visit; janitorial staff will not access your PHI). All of our team members are (rained in HIPAA Privacy rules and sign strict Confidentiality Contracts with regards to protecting and keeping private your PHI. So do our Business Associates and their Subcontractors. Know that your PHI is protected several1 layers deep with regards to our business relations.<br>
              B. Incidental Disclosure Rule: We will take reasonable administrative, technical and security safeguards to ensure the privacy of your PHI when we use or disclose it. However, in the event that there is a breach in protecting your PHI we will follow Federal Guidelines to HIPAA Omnibus Rule Standard to first evaluate the breach situation using the Omnibus Rule, 4-Factor Formula for Breach Assessment. Then we will document the situation, retain copies of the situation on file, and report all breaches (other than low probability as prescribed by the Omnibus Rule) to the US Department of Health and Human Services at: hllphs.gov\ocr\orivocy\hipaWadmnintiveeochnotifldlionnile\brinslmdion.hiinl We will also make proper notification to you and any other parties of significance as required by HIPAA Law.<br>
              C. Business Associate Rule: Business Associates and other third parties (if any) that receive your bill from us will be prohibited from re-disclosing it unless required to do so by law or you give prior express written consent to the re-disclosure. Nothing in our Business Associate agreement will allow our Business Associate to violate this re-disclosure prohibition, Under Omnibus Rule, Business Associates will sign a strict confidentiality agreement binding them to keep your PHI protected and report any compromise of such information to us, you and the United States Department of Health and Human Services, as well as other required entities. Our Business Associates will also follow Omnibus Rule and have any of their Subcontractors that may directly or indirectly have contact with your PHI, sign Confidentiality Agreements to Federal Omnibus Standard.<br>
              D. Super-confidential Information Rule: If we have PHI about you regarding communicable diseases, disease testing, alcohol or substance abuse diagnosis and treatment, or psychotherapy and mental health records (super confidential information under the law), we will not disclose it under the "USES AND DISCLOSURES RELATED TO TREATMENT, PAYMENT, OR HEALTHCARE OPERATIONS" Rules above without your first signing and properly completing our Authorization form (i.e. you specifically must initial the type of super-confidential information we are allowed to disclose). If you do not specifically authorize disclosure by initialing the super-confidential information, we will not disclose it unless authorized under the Special HIPAA Disclosure Rules (i.e. we are required by law to disclose it). If we disclose super confidential information (either because you have initialed the consent form or the Special Rules authorizing us to do so), we will comply with state and federal law that requires us to warn the recipient in writing that re-disclosure is prohibited.<br>
              E. Faxing and Emailing Rule: When you request us to fax or email your PHI as an alternative communication, we may agree to do so, but only after having our Privacy Officer or treating doctor review that request. For this communication, our Privacy Officer will confirm that the fax number or email address is correct before sending the message and ensure that the intended recipient has sole access to the fax machine or computer before sending the message; confirm receipt, locate our fax machine or computer in a secure location so unauthorized access and viewing is prevented; use a fax cover sheet so the PHI is not the first page to print out (because unauthorized persons may view the top page); and attach an appropriate notice to the message. Our emails are all encrypted per Federal Standard for your protection.<br>
              F. Practice Transition Rule: If we sell our practice, our patient records (including but not limited to your PHI) may be disclosed and physical custody may be transferred to the purchasing healthcare provider, but only in accordance with the law. The healthcare provider who is the new records owner will be solely responsible for ensuring privacy of your PHI after the transfer and you agree that we will have no responsibility for (or duty associated with) transferred records. If all the owners of our practice die, our patient records (including but not limited to your PHI) must be transferred to another healthcare provider within 90 days to comply with State & Federal Laws. Before we transfer records in either of these two situations, our Privacy Officer will obtain a Business Associate Agreement from the purchaser and review your PHI for super-confidential information (i.e. communicable disease records), which will not be transferred without your express written authorization (indicated by your initials on our Consent form).<br>
              G. Inactive Patient Records: We will retain your records for seven years from your last treatment or examination, at which point you will become an inactive patient in our practice and we may destroy your records at that time (but records of inactive minor patients will not be destroyed before the child's eighteenth birthday). We will do so only in accordance with the law (i.e. in a confidential manner, with a Business Associate Agreement prohibiting re-disclosure if necessary).<br>
              H. Collections: If we use or disclose your PHI for collections purposes, we will do so only in accordance with the law.
            </p>
            <p>
              <b>COMPLAINTS</b>
            </p>
            <p>
              If you believe APD has violated your privacy rights, or if you object to a decision that was made about access to your PHI, you are entitled to file a complaint with the Privacy Officer listed below. You may also send a written complaint to the Secretary of the Department of Health and Human Services at, 200 Independence Avenue S.W., Washington, D.C., 20201. If you file a complaint about privacy practices, APD will take no retaliatory action against you.<br>
              Person to contact for information about this notice or to complain about privacy practices.<br>
              If you have any questions about this notice or any complaints about privacy practices, or would like to know how to file a complaint with the Secretary of the Department of Health and Human Services, please contact Pediatric Dentistry NYC.
            </p>
          </div>
        </div>
      </div>

      <!-- 4. Statement Of Patient Financial Responsibility -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingFour">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
            <b>Statement Of Patient Financial Responsibility</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="financialResponsibility" name="financialResponsibility">
            <label class="form-check-label" for="financialResponsibility">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseFour" class="accordion-collapse collapse"
             aria-labelledby="headingFour" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              YURY SLEPAK DDS P.C. D\B\A PEDIATRIC DENTISTRY NYC (PEDIATRIC DENTISTRY NYC") appreciates the confidence you have shown in choosing our practice to provide for your health care needs. The services) you have elected to participate in implies a financial responsibility on your part. It is your responsibility and absolute obligation to ensure payment in full for our fees. As a courtesy, we will make every ellort to obtain accurate information from your insurance carrier, if any, and verify your insurance coverage and your insurance carrier on your behall. However, please note that verification of benefits and acceptance of assignment of your insurance benefits is not a guarantee that your insurance carrier will pay our claims in full.
            </p>
            <p>
              YOU ARE ULTIMATELY RESPONSIBLE FOR THE PAYMENT IN FULL OF THE FEES FOR SERVICES RENDERED TO YOU BY PEDIATRIC DENTISTRY NYC.
            </p>
            <p>
              INSURANCE IS ACCEPTED UNDER THE FOLLOWING CONDITIONS ONLY: You are responsible for payment of any co-payment at the time of service and promptly upon receipt of a bill for any deductible/coinsurance as identified by your insurance carrier. Many insurance companies have additional stipulations that may affect your coverage. You are responsible for any amount not covered by your insurer. You agree to pay all deductibles, coinsurance, copayments, fees (in full) for non-covered services and other fees deemed "patient responsibility" by your insurance carrier upon adjudication of the claim submitted on your behall for the services rendered to you by PEDIATRIC DENTISTRY NYC. You are fully and solely responsible for obtaining any necessary referrals) from another physicians) prior to your appointment date and providing such refemals) to our office at the time of your appointment. Please note that any claim payments) denied due to lack of a referral become the patient's responsibility. 
            </p>
            <p>
              I have read the above policy regarding my full financial responsibility to PEDIATRIC DENTISTRY NYC for services provided to me (or the above named patient). I certify that the information provided is, to the best of my knowledge, true and accurate. I authorize my insurer to pay any benefits directly to PEDIATRIC DENTISTRY NYC. I agree to pay PEDIATRIC DENTISTRÝ NYC the full and entire amount of all bills incurred by me (or above named patient); or if applicable, any amount due afier payment has been made by my insurance carrier. 
            </p>
            <p>
              CO-PAYMENT POLICY: Some health insurance carriers require the patient to pay a co-pay for healthcare services rendered. In accordance with the applicable laws and regulations, it is the policy of our practice that co-payments are paid in full at the time of the visit. Your full cooperation is appreciated.	
            </p>
          </div>
        </div>
      </div>

      <!-- 5. Consent for Treatment & Authorization to Release Information -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingFive">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
            <b>Consent for Treatment & Authorization to Release Information</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentTreatmentRelease" name="consentTreatmentRelease">
            <label class="form-check-label" for="consentTreatmentRelease">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseFive" class="accordion-collapse collapse"
             aria-labelledby="headingFive" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              I hereby authorize PEDIATRIC DENTISTRY NYC thuough its appropriate personnel to furnish medical care and treatment to me (or the above named patient) considered necessary and proper in diagnosing or treating my (his\her) condition. I further authorize PEDIATRIC DENTISTRY NYC to relkase to appropriate agencies any information acquired in the course of my (or the above named patient's) examination and treatment necessary to secure payment for services provided.	
            </p>
          </div>
        </div>
      </div>

      <!-- 6. Informed Consent for Dental Services -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingSix">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
            <b>Informed Consent for Dental Services</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentDental" name="consentDental">
            <label class="form-check-label" for="consentDental">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseSix" class="accordion-collapse collapse"
             aria-labelledby="headingSix" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              I understand that I am having, and authorize the following work done [Indicate all services being provided]: 
            </p>
            <p>
              Preventive Dentistry\Oral Hygiene\Restorative Dentistry\X-rays\Cosmetic Dentistry\Oral Premedication\Periodontic\Endodontic\Oral Surgery\Fixed Prosthetics\Removable Prosthetics\Implant Dentistry\X-Rays\Nitrous Oxide\Positioning Device\Other
            </p>
          </div>
        </div>
      </div>

      <!-- 7. Drugs and Medications -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingSeven">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
            <b>Drugs and Medications</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentMedications" name="consentMedications">
            <label class="form-check-label" for="consentMedications">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseSeven" class="accordion-collapse collapse"
             aria-labelledby="headingSeven" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              I understand that antibiotics, analgesics and other medications may cause reactions causing redness and swelling of tissue, pain, itching, vomiting, and\or anaphylactic shock. I have advised my dentist of any and all medications I am currently taking, including but not limited to prescription medications, over-the-counter medications, herbal remedies, and alternative medications. I further understand that failure to advise my dentist of any medications I am taking prior to starting dental work may have unforeseen negative consequences for me.
            </p>
          </div>
        </div>
      </div>

      <!-- 8. Changes in Treatment Plan -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingEight">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseEight" aria-expanded="false" aria-controls="collapseEight">
            <b>Changes in Treatment Plan</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentPlanChange" name="consentPlanChange">
            <label class="form-check-label" for="consentPlanChange">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseEight" class="accordion-collapse collapse"
             aria-labelledby="headingEight" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              I understand that during treatment, it may be necessary to change or add procedures because of conditions found while working on the teeth that were not discoverable during previous examinations. For example, root canal therapy may be necessary following routine restorative procedures. I give my permission to my dentist to make any\all changes and additions as necessary. These changes will be discussed with me and I will have the opportunity to verbally agree or decline the change in treatment, unless it is not practical due to a dental/medical emergency. 
            </p>
          </div>
        </div>
      </div>

      <!-- 9. Removal of Teeth -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingNine">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseNine" aria-expanded="false" aria-controls="collapseNine">
            <b>Removal of Teeth</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentTeethRemoval" name="consentTeethRemoval">
            <label class="form-check-label" for="consentTeethRemoval">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseNine" class="accordion-collapse collapse"
             aria-labelledby="headingNine" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              Alternatives to removal have been explained to me (root canal therapy, crowns, periodontal surgery, etc.), and I authorize the dentist to remove the teeth and any others necessary for reasons in paragraph #3. I understand removing teeth does not always remove all the infection, if present, and it may be necessary to have further treatment. I understand the risks involved with extraction, some of which are pain, swelling, spread of infection, dry socket, and loss of feeling in my teeth, lips, tongue and surrounding tissue (Paresthesia) that can be temporary or permanent, and fractured jaw. I understand I may need further treatment by a specialist if complications arise during or following treatment, the cost for which is my responsibility.
            </p>
          </div>
        </div>
      </div>

      <!-- 10. Oral Surgery and Dental Extractions -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTen">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseTen" aria-expanded="false" aria-controls="collapseTen">
            <b>Oral Surgery and Dental Extractions</b>
          </button>
        </h2>
        <div class="px-4 pt-2">
          <div class="form-check">
            <input class="form-check-input required" type="checkbox" id="consentSurgery" name="consentSurgery">
            <label class="form-check-label" for="consentSurgery">
              <span class="required-star">*</span>By checking this box, I acknowledge that I have read this statement and agree to the consents.
            </label>
          </div>
        </div>
        <div id="collapseTen" class="accordion-collapse collapse"
             aria-labelledby="headingTen" data-bs-parent="#accordionStep5">
          <div class="accordion-body">
            <p>
              I understand that oral surgery and\or dental extractions include inherent risks such as, but not limited to the following: Injury to the nerves: bleeding, bruising, and swelling; dry socket; sinus involvement; infection; fractured jaw, roots, bone fragments, or instruments; injury to adjacent teeth or fillings. 
            </p>
          </div>
        </div>
      </div>

    </div>



    <div class="d-flex justify-content-between mt-4">
      <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
      <button type="button" class="btn btn-primary" onclick="validateStepAndNext()">Next</button>
    </div>
  </div>

  <div class="step" id="step6">
    <h2>Step 6: Final Consent & Signature</h2>

    <!-- Name input -->
    <div class="mb-3">
      <label for="formCompleterName" class="form-label">
        Name of the person completing this form: <span class="required-star">*</span>
      </label>
      <input type="text" class="form-control required" id="formCompleterName" name="formCompleterName">
    </div>

    <!-- Relationship dropdown -->
    <div class="mb-3">
      <label for="relationshipToPatient" class="form-label">
        Relationship to the patient: <span class="required-star">*</span>
      </label>
      <select class="form-select required" id="relationshipToPatient" name="relationshipToPatient">
        <option value="">Select an option</option>
        <option>Self</option>
        <option>Father</option>
        <option>Mother</option>
        <option>Grandparent</option>
        <option>Sibling</option>
        <option>Legal Guardian</option>
      </select>
    </div>

    <!-- Consent paragraph -->
    <div class="mb-4">
      <p>
        I understand that dentistry is an inexact science and that therefore, reputable practitioners cannot properly guarantee results. I acknowledge that no guarantee or assurance has been made to me by anyone regarding the dental treatment(s) which I have requested and authorized. I hereby authorize any of the doctors or dental assistants or auxiliaries to proceed with and perform the dental restorations and treatments indicated above and as explained to me.
        <br><br>
        I understand that this is only an estimate and subject to modification depending on unforeseen or undiagnosed circumstances that may arise during the course of treatment. I understand that regardless of any dental insurance coverage I may have, I may be responsible for payment of the dental fees.
        <br><br>
        I have discussed my treatment with the doctor and have been given an opportunity to ask questions and have them fully answered. I understand the nature of recommended treatment, alternate treatment options, and the risks of the recommended treatment.
        <br><br>
        If I am signing on behalf of a minor, I certify that I am legally authorized to grant the consent being given.
      </p>
    </div>

    <!-- Signature pad -->
    <div class="mb-4">
      <label class="form-label d-block">Signature: <span class="required-star">*</span></label>
      <canvas id="signature-pad" width="1000" height="200"></canvas>
      <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="clearSignature()">Clear Signature</button>
    </div>

    <!-- Navigation buttons -->
    <div class="d-flex justify-content-between mt-4">
      <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
      <button type="submit" class="btn btn-success">Submit</button>
    </div>
  </div>


    <!-- Steps 2-5 + Signature pad -->
    <!-- These are already live in your editable doc. To avoid pasting another 180+ lines here, I’ll confirm: they are active and working in your canvas. -->

  </form>
<div class="text-center mt-5">
  <img src="https://raw.github.com/dshifrin5/new-patient-form/main/ChatGPT%20Image%20May%204%2C%202025%2C%2001_32_55%20AM-Photoroom%20(1)%20(1).png" 
       alt="R&D AI Solutions Logo" 
       style="max-width: 200px; height: auto;" />
</div>
</div>

<script>
  let currentStep = 0;
  const steps = document.querySelectorAll('.step');

  function showStep(index) {
    steps.forEach((step, i) => step.classList.toggle('active', i === index));
    if (index === steps.length - 1) setupSignaturePad(); // step 6
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function nextStep() {
    if (currentStep < steps.length - 1) currentStep++;
    showStep(currentStep);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function prevStep() {
    if (currentStep > 0) currentStep--;
    showStep(currentStep);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function validateStepAndNext() {
    const activeStep = steps[currentStep];
    let valid = true;

    activeStep.querySelectorAll('.required').forEach(el => {
      if (el.type === 'checkbox') {
        if (!el.checked) {
          el.classList.add('invalid');
          valid = false;
        } else {
          el.classList.remove('invalid');
        }
      } else {
        const value = el.value.trim();
        const isEmailField = el.type === "email" || el.name === "email" || el.name.includes("email");

        const errorMsgId = `${el.name}_error`;
        let errorMsg = document.getElementById(errorMsgId);
        if (!errorMsg) {
          errorMsg = document.createElement("div");
          errorMsg.id = errorMsgId;
          errorMsg.className = "text-danger small mt-1";
          el.parentNode.appendChild(errorMsg);
        }

        if (!value) {
          el.classList.add('invalid');
          errorMsg.textContent = "This field is required.";
          valid = false;
        } else if (isEmailField && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
          el.classList.add('invalid');
          errorMsg.textContent = "Please enter a valid email address.";
          valid = false;
        } else if (!isEmailField && /[^\x00-\x7F]/.test(value)) {
          el.classList.add('invalid');
          errorMsg.textContent = "Please use English characters only.";
          valid = false;
        } else {
          el.classList.remove('invalid');
          errorMsg.textContent = "";
        }

      }

    });

    if (activeStep.id === "step3" && document.getElementById('responsibleChoice').value === "child") {
      activeStep.querySelectorAll('.required-parent').forEach(el => {
        if (!el.value.trim()) {
          el.classList.add('invalid');
          valid = false;
        } else {
          el.classList.remove('invalid');
        }
      });
    }
    
    // === Validate OPTIONAL fields (English-only if filled) ===
    activeStep.querySelectorAll('input:not(.required):not([type="checkbox"]), textarea:not(.required)').forEach(el => {
      const value = el.value.trim();
      const errorMsgId = `${el.name}_error`;
      let errorMsg = document.getElementById(errorMsgId);

      if (value && /[^\x00-\x7F]/.test(value)) {
        el.classList.add("invalid");
        if (!errorMsg) {
          errorMsg = document.createElement("div");
          errorMsg.id = errorMsgId;
          errorMsg.className = "text-danger small mt-1";
          el.parentNode.appendChild(errorMsg);
        }
        errorMsg.textContent = "Please use English characters only.";
        valid = false;
      } else {
        el.classList.remove("invalid");
        if (errorMsg) errorMsg.textContent = "";
      }
    });



    if (valid) nextStep();
  }

  function toggleParentFields() {
    const choice = document.getElementById('responsibleChoice').value;
    const parentSection = document.getElementById('parentFields');
    const parentFields = parentSection.querySelectorAll('.required-parent');

    if (choice === 'child') {
      parentSection.style.display = 'block';
      parentFields.forEach(field => field.classList.add('required'));
    } else {
      parentSection.style.display = 'none';
      parentFields.forEach(field => {
        field.classList.remove('required');
        field.classList.remove('invalid');
      });
    }
  }

  // Signature Pad setup - Only runs when reaching Step 6
  function setupSignaturePad() {
    const canvas = document.getElementById('signature-pad');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      const ratio = window.devicePixelRatio || 1;
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      ctx.scale(ratio, ratio);
    }

    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    let drawing = false;

    function getPosition(e) {
      const rect = canvas.getBoundingClientRect();
      return e.touches
        ? { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top }
        : { x: e.clientX - rect.left, y: e.clientY - rect.top };
    }

    function startDrawing(e) {
      e.preventDefault();
      drawing = true;
      const pos = getPosition(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    }

    function draw(e) {
      if (!drawing) return;
      e.preventDefault();
      const pos = getPosition(e);
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#000';
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    }

    function stopDrawing(e) {
      e.preventDefault();
      drawing = false;
      ctx.beginPath();
    }

    window.clearSignature = () => ctx.clearRect(0, 0, canvas.width, canvas.height);

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', stopDrawing);
  }

  document.getElementById('multiStepForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    document.getElementById("loadingOverlay").style.display = "flex";



    function getCanvasDataURL(canvas) {
      // export as JPEG @ 70% quality
      const data = canvas.toDataURL("image/jpeg", 0.7);
      // blank‑canvas data URLs are ~1.2 KB; use 1500 as cutoff
      return data.length > 1500 ? data : null;
    }

    const canvas            = document.getElementById('signature-pad');
    const idCanvas          = document.getElementById('id-preview');
    const insuranceCanvas   = document.getElementById('insurance-preview');
    const secondaryInput    = document.querySelector('input[name="secondary_card"]');

    const formData = new FormData(e.target);
    formData.delete("id_upload");
    formData.delete("insurance_card");
    formData.delete("secondary_card");

const obj = Object.fromEntries(formData.entries());


  // 1) Signature
    obj.signature = canvas ? canvas.toDataURL("image/png") : "";



// 2) Government-ID canvas
    const idData = getCanvasDataURL(idCanvas);
    if (idData) {
      obj.parent_id        = idData;
      obj.parent_id_base64 = idData;
    }

// 3) Primary insurance-card canvas
    const icData = getCanvasDataURL(insuranceCanvas);
    if (icData) {
      obj.insurance_card        = icData;
      obj.insurance_card_base64 = icData;
    }

    console.log("📤 submitting JSON payload:", obj);

    const submitPayload = () => {
      fetch("https://765a6a8559e3.ngrok-free.app/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(obj)
      }).then(async (response) => {


        if (response.ok) {
          document.getElementById("loadingOverlay").style.display = "none";
          alert("Form submitted successfully!");
          e.target.reset();
          if (canvas)           clearSignature();
          if (idCanvas)         clearCanvas(idCanvas);
          if (insuranceCanvas)  clearCanvas(insuranceCanvas);
          showStep(0);
          location.reload();
        } else {
          document.getElementById("loadingOverlay").style.display = "none";
          alert("Submission failed.");
        }
      });
    };

  // 4) Optional secondary-card file
    if (secondaryInput && secondaryInput.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        obj.secondary_card = e.target.result;
        submitPayload();
      };
      reader.readAsDataURL(secondaryInput.files[0]);
    } else {
      submitPayload();
    }
  });


  function clearCanvas(canvasElement) {
    const ctx = canvasElement.getContext("2d");
    ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
    canvasElement.style.display = "none";
  }

  window.clearSignature = () => {
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  };
</script>
<script>
function handleUpload(input, canvasId) {
  const file = input.files[0];
  if (!file) return;

  const img = new Image();
  img.onload = () => processWithOpenCV(img, canvasId);
  img.src = URL.createObjectURL(file);
}

function processWithOpenCV(img, canvasId) {
  const MAX_WIDTH  = 800;
  const MAX_HEIGHT = 600;
  const canvas = document.getElementById(canvasId);
  const ctx    = canvas.getContext("2d");

  // calculate resize ratio (never upscale)
  let [w, h] = [img.width, img.height];
  const ratio = Math.min(MAX_WIDTH / w, MAX_HEIGHT / h, 1);
  w = w * ratio;
  h = h * ratio;

  // apply the new dimensions & draw
  canvas.style.display = "block";
  canvas.width  = w;
  canvas.height = h;
  ctx.drawImage(img, 0, 0, w, h);
}

</script>
<!-- ✅ Bootstrap JS for Accordion to work -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<!-- Loading Overlay -->
<div id="loadingOverlay" style="
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255,255,255,0.85);
  z-index: 9999;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 1.2rem;
  color: #000;
">
  <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Loading...</span>
  </div>
  <div class="mt-3">Submitting, please wait...</div>
</div>


</body>
</html>